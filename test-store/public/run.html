<!DOCTYPE html>
<html>
<head>
    <title>Running Checkout...</title>
</head>
<body>
<h1>Processing Cart…</h1>
<div id="status"></div>

<script>
const statusDiv = document.getElementById("status");

function getUrls() {
    const params = new URLSearchParams(window.location.search);
    const urlsParam = params.get("urls");
    if (!urlsParam) return [];
    return urlsParam.split(",").map(u => decodeURIComponent(u));
}

async function processCart(urls) {
    for (let i = 0; i < urls.length; i++) {
        const url = urls[i];
        statusDiv.innerHTML = `Adding item ${i+1} of ${urls.length}...`;
        console.log(`Opening ${url}`);
        const win = window.open(url, "_blank");
        if (!win) {
            alert("Popup blocked! Please allow popups for this site.");
            return;
        }
        await new Promise(r => setTimeout(r, 1500)); // wait for VE to register
    }

    // After all items, redirect user to cart
    statusDiv.innerHTML = "All items added! Redirecting to final cart…";
    window.location.href = "https://portal.veinternational.org/buybuttons/us019814/cart/";
}

const urls = getUrls();
processCart(urls);
</script>
</body>
</html>
