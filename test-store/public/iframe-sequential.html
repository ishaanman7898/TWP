<!DOCTYPE html>
<html>
<head>
    <title>Sequential VEI Checkout (Iframe)</title>
</head>
<body>
<h1>Processing Cart…</h1>
<div id="status"></div>

<iframe id="veiFrame" width="800" height="600" style="display:none;"></iframe>

<script>
const statusDiv = document.getElementById("status");
const frame = document.getElementById("veiFrame");

function getUrls() {
    const params = new URLSearchParams(window.location.search);
    const urlsParam = params.get("urls");
    if (!urlsParam) return [];
    return urlsParam.split(",").map(u => decodeURIComponent(u));
}

async function processCart(urls) {
    for (let i = 0; i < urls.length; i++) {
        const url = urls[i];
        statusDiv.innerHTML = `Adding item ${i+1} of ${urls.length}...`;
        console.log(`Loading ${url} in iframe`);
        
        // Load VEI buy button in iframe
        frame.src = url;
        
        // Wait for VEI to register (iframe might not work due to X-Frame-Options)
        await new Promise(r => setTimeout(r, 2000));
    }

    // After all items, redirect to cart
    statusDiv.innerHTML = "All items added! Redirecting to final cart…";
    setTimeout(() => {
        window.location.href = "https://portal.veinternational.org/buybuttons/us019814/cart/";
    }, 1000);
}

const urls = getUrls();
processCart(urls);
</script>
</body>
</html>
